//var async = require('async');

module.exports = {
	parse: function(text) {

		// replace links
    text = text.replace(/(http[^ ]+)/ig, '<a target="_blank" title="$1" href="$1">$1</a>');

    /*
    var links = text.match(/http[^ ]+/i);
    if (links) async.forEach(links,
          function(item, next){
            var attrs = '';
            if (item.match('twitpic')) {
              attrs += 'omouseover="console.log(\'show image \', this.href)"';

            } else if (item.match('t\.co')) {
              attrs += 'omouseover="console.log(\'show thumbnail of \', this.href)"';
            }

            var link = '<a target="_blank" href="' + item + '" ' + attrs + '>' + item + '</a>';
            text = text.replace(item, link);
          },
          function(err){
            
          })
    */
    
		
    // replace hashtags
    text = text.replace(/(#[^ #\.!\?]+)/ig, '<a class="hashtag" href="//twitter.com/$1">$1</a>');
		
		// replace usernames
	 	text = text.replace(/@(\w+)/ig, '<a class="username" href="//twitter.com/$1">@$1</a>');

		return text;
	}
}